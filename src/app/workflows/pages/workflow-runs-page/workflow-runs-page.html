<div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px;">
  <div>
    <h2 style="margin:0;">Runs</h2>
    <div style="font-size:12px; opacity:.7;">Workflow #{{ workflowId() }}</div>
  </div>

  <div style="display:flex; gap:8px; align-items:center;">
    <button (click)="backToDesigner()">Back to Designer</button>
    <button (click)="refresh()">Refresh</button>
    <button (click)="clearHistory()" [disabled]="runs().length === 0">Clear history</button>
  </div>
</div>

<div style="display:grid; grid-template-columns: 280px 1fr; gap:12px; height: calc(100vh - 170px);">
  <!-- Left: run list -->
  <div style="border:1px solid #ddd; border-radius:10px; padding:10px; overflow:auto;">
    <div style="font-weight:700; margin-bottom:8px;">Run history</div>

    @if (runs().length === 0) {
      <div style="opacity:.7;">No runs yet.</div>
    }

    @for (r of runs(); track r.runId) {
      <div
        (click)="selectRun(r.runId)"
        [style.background]="r.runId === selectedRunId() ? '#f2f2f2' : 'transparent'"
        style="padding:10px; border:1px solid #eee; border-radius:10px; cursor:pointer; margin-bottom:6px;"
      >
        <div style="font-weight:600;">Run {{ r.runId.slice(0, 8) }}</div>
        <div style="font-size:12px; opacity:.7;">
          {{ r.createdAt | date:'short' }} • ext: {{ r.extension }}
        </div>
      </div>
    }
  </div>

  <!-- Right: run details -->
  <div style="border:1px solid #ddd; border-radius:10px; padding:10px; overflow:auto;">
    @if (!selectedRun()) {
      <div style="opacity:.7;">Select a run to view details.</div>
    }

    @if (selectedRun(); as run) {
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <div>
          <div style="font-weight:800;">Run {{ run.runId }}</div>
          <div style="font-size:12px; opacity:.7;">
            {{ run.createdAt | date:'short' }} • extension: {{ run.extension }}
          </div>
        </div>
      </div>

      <!-- Steps list like GitHub Actions -->
      <div style="border:1px solid #eee; border-radius:10px; overflow:hidden;">
        @for (s of run.result.stepRuns; track s.stepId) {
          <div
            (click)="toggleStep(s.stepId)"
            style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;"
          >
            <div style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                <div style="font-weight:600;">{{ s.stepName }}</div>
                <div style="font-size:12px; opacity:.7;">
                  {{ stepStatusLabel(s) }}
                  • {{ s.cached ? "cached" : "fresh" }}
                  • stepId: {{ s.stepId }}
                </div>
              </div>
              <div style="opacity:.6;">
                {{ expandedStepId() === s.stepId ? "▾" : "▸" }}
              </div>
            </div>

            @if (expandedStepId() === s.stepId) {
              <div style="margin-top:10px; padding:10px; background:#fafafa; border-radius:10px;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                  <div>
                    <div style="font-weight:700; margin-bottom:6px;">Variables</div>
                    <pre style="margin:0; font-size:12px; background:white; border:1px solid #eee; padding:10px; border-radius:10px; max-height:220px; overflow:auto;">{{ s.outputs?.variables | json }}</pre>
                  </div>

                  <div>
                    <div style="font-weight:700; margin-bottom:6px;">Outputs</div>
                    <pre style="margin:0; font-size:12px; background:white; border:1px solid #eee; padding:10px; border-radius:10px; max-height:220px; overflow:auto;">{{ s.outputs | json }}</pre>
                    <div style="font-size:12px; opacity:.7; margin-top:6px;">
                      exportFile: {{ s.exportFile ? (s.exportFile | json) : "null" }}
                    </div>
                  </div>

                  <div style="grid-column: 1 / -1;">
                    <div style="font-weight:700; margin-bottom:6px;">Logs</div>
                    <pre style="margin:0; font-size:12px; background:#0b0f14; color:#e6edf3; padding:10px; border-radius:10px; max-height:260px; overflow:auto;">{{ s.logs }}</pre>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
</div>
